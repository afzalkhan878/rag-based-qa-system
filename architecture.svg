<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 900">
  <!-- Title -->
  <text x="400" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
    Advanced RAG System Architecture
  </text>
  
  <!-- User Layer -->
  <rect x="300" y="60" width="200" height="60" rx="10" fill="#4A90E2" stroke="#2C5F8D" stroke-width="2"/>
  <text x="400" y="95" font-size="16" font-weight="bold" text-anchor="middle" fill="white">User Query</text>
  
  <!-- Arrow -->
  <line x1="400" y1="120" x2="400" y2="160" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- API Layer -->
  <rect x="250" y="160" width="300" height="80" rx="10" fill="#50C878" stroke="#2E7D4E" stroke-width="2"/>
  <text x="400" y="190" font-size="16" font-weight="bold" text-anchor="middle" fill="white">API Layer (Flask)</text>
  <text x="400" y="215" font-size="12" text-anchor="middle" fill="white">/ingest | /query | /metrics</text>
  <text x="400" y="232" font-size="11" text-anchor="middle" fill="white">REST endpoints, validation</text>
  
  <!-- Arrow -->
  <line x1="400" y1="240" x2="400" y2="280" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- RAG Orchestrator -->
  <rect x="200" y="280" width="400" height="80" rx="10" fill="#9B59B6" stroke="#6C3483" stroke-width="2"/>
  <text x="400" y="310" font-size="16" font-weight="bold" text-anchor="middle" fill="white">RAG Orchestrator</text>
  <text x="400" y="335" font-size="12" text-anchor="middle" fill="white">Document management</text>
  <text x="400" y="352" font-size="12" text-anchor="middle" fill="white">Query routing & coordination</text>
  
  <!-- Arrows to components -->
  <line x1="300" y1="360" x2="200" y2="410" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="500" y1="360" x2="600" y2="410" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Semantic Chunker -->
  <rect x="50" y="410" width="300" height="140" rx="10" fill="#F39C12" stroke="#D68910" stroke-width="2"/>
  <text x="200" y="440" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Semantic Chunker</text>
  <text x="200" y="465" font-size="11" text-anchor="middle" fill="white">• Sentence splitting</text>
  <text x="200" y="485" font-size="11" text-anchor="middle" fill="white">• Semantic density calculation</text>
  <text x="200" y="505" font-size="11" text-anchor="middle" fill="white">• Adaptive sizing</text>
  <text x="200" y="525" font-size="11" text-anchor="middle" fill="white">• Context overlap</text>
  <text x="200" y="542" font-size="10" font-style="italic" text-anchor="middle" fill="#FFF">Target: 512 | Min: 100 | Max: 1024</text>
  
  <!-- Hybrid Retriever -->
  <rect x="450" y="410" width="300" height="140" rx="10" fill="#E74C3C" stroke="#C0392B" stroke-width="2"/>
  <text x="600" y="440" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Hybrid Retriever</text>
  <text x="600" y="465" font-size="11" text-anchor="middle" fill="white">• Vector similarity search</text>
  <text x="600" y="485" font-size="11" text-anchor="middle" fill="white">• Keyword (BM25) matching</text>
  <text x="600" y="505" font-size="11" text-anchor="middle" fill="white">• Score fusion</text>
  <text x="600" y="525" font-size="11" text-anchor="middle" fill="white">• Metrics tracking</text>
  <text x="600" y="542" font-size="10" font-style="italic" text-anchor="middle" fill="#FFF">Alpha: 0.7 (vector) + 0.3 (keyword)</text>
  
  <!-- Arrows to storage -->
  <line x1="200" y1="550" x2="200" y2="600" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="550" y1="550" x2="550" y2="600" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="650" y1="550" x2="650" y2="600" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Storage Layer -->
  <!-- ChromaDB -->
  <rect x="80" y="600" width="240" height="100" rx="10" fill="#34495E" stroke="#2C3E50" stroke-width="2"/>
  <text x="200" y="630" font-size="16" font-weight="bold" text-anchor="middle" fill="white">ChromaDB</text>
  <text x="200" y="655" font-size="12" text-anchor="middle" fill="white">Vector Store</text>
  <text x="200" y="675" font-size="11" text-anchor="middle" fill="#AAA">Embeddings: all-MiniLM-L6-v2</text>
  <text x="200" y="692" font-size="11" text-anchor="middle" fill="#AAA">HNSW index, cosine similarity</text>
  
  <!-- Keyword Index -->
  <rect x="480" y="600" width="240" height="100" rx="10" fill="#34495E" stroke="#2C3E50" stroke-width="2"/>
  <text x="600" y="630" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Keyword Index</text>
  <text x="600" y="655" font-size="12" text-anchor="middle" fill="white">Inverted Index</text>
  <text x="600" y="675" font-size="11" text-anchor="middle" fill="#AAA">word → {chunk_ids}</text>
  <text x="600" y="692" font-size="11" text-anchor="middle" fill="#AAA">IDF-based scoring</text>
  
  <!-- Arrows back to fusion -->
  <line x1="200" y1="700" x2="200" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="600" y1="700" x2="600" y2="750" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="200" y1="750" x2="350" y2="750" stroke="#333" stroke-width="2"/>
  <line x1="600" y1="750" x2="450" y2="750" stroke="#333" stroke-width="2"/>
  <line x1="400" y1="750" x2="400" y2="780" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Score Fusion -->
  <rect x="250" y="780" width="300" height="60" rx="10" fill="#16A085" stroke="#117A65" stroke-width="2"/>
  <text x="400" y="810" font-size="16" font-weight="bold" text-anchor="middle" fill="white">Score Fusion &amp; Ranking</text>
  <text x="400" y="832" font-size="11" text-anchor="middle" fill="white">Hybrid scoring → Top-k selection</text>
  
  <!-- Arrow to results -->
  <line x1="400" y1="840" x2="400" y2="870" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Results -->
  <rect x="250" y="870" width="300" height="20" rx="5" fill="#27AE60" stroke="#1E8449" stroke-width="2"/>
  <text x="400" y="885" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Ranked Results + Metrics</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
      <polygon points="0 0, 10 5, 0 10" fill="#333"/>
    </marker>
  </defs>
  
  <!-- Legend -->
  <g transform="translate(20, 20)">
    <text x="0" y="0" font-size="12" font-weight="bold" fill="#333">Legend:</text>
    <rect x="0" y="5" width="15" height="15" fill="#4A90E2"/>
    <text x="20" y="17" font-size="10" fill="#333">User Interface</text>
    
    <rect x="0" y="25" width="15" height="15" fill="#50C878"/>
    <text x="20" y="37" font-size="10" fill="#333">API Layer</text>
    
    <rect x="0" y="45" width="15" height="15" fill="#9B59B6"/>
    <text x="20" y="57" font-size="10" fill="#333">Orchestration</text>
    
    <rect x="0" y="65" width="15" height="15" fill="#F39C12"/>
    <text x="20" y="77" font-size="10" fill="#333">Processing</text>
    
    <rect x="0" y="85" width="15" height="15" fill="#E74C3C"/>
    <text x="20" y="97" font-size="10" fill="#333">Retrieval</text>
    
    <rect x="0" y="105" width="15" height="15" fill="#34495E"/>
    <text x="20" y="117" font-size="10" fill="#333">Storage</text>
  </g>
  
  <!-- Key Metrics Box -->
  <rect x="620" y="20" width="160" height="140" rx="5" fill="#ECF0F1" stroke="#BDC3C7" stroke-width="1"/>
  <text x="700" y="40" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">Performance</text>
  <text x="630" y="60" font-size="10" fill="#555">Avg Query: 78ms</text>
  <text x="630" y="78" font-size="10" fill="#555">P95 Query: 124ms</text>
  <text x="630" y="96" font-size="10" fill="#555">Chunk Size: 512±400</text>
  <text x="630" y="114" font-size="10" fill="#555">Top-k: 5 default</text>
  <text x="630" y="132" font-size="10" fill="#555">Similarity: cosine</text>
  <text x="630" y="150" font-size="10" fill="#555">Embedding: 384-dim</text>
</svg>
